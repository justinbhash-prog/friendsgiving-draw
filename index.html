<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Virtual Friendsgiving Draw</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #faf3e6;
    padding: 20px;
    max-width: 720px;
    margin: auto;
  }
  h1 { 
    color: #8b4513; 
    text-align: center; 
    font-size: 2.2rem;
  }
  h2 {
    color: #8b4513;
  }
  .hidden { 
    display:none; 
  }
  .box {
    background:#fff; 
    padding:20px; 
    border-radius:10px; 
    margin-top:20px;
    border:1px solid #d2a679;
  }
  button {
    padding:10px 14px; 
    background:#8b4e24; 
    color:white; 
    border:none;
    border-radius:6px; 
    cursor:pointer;
    margin-top: 10px;
  }
  button:hover {
    background:#a05a2a;
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  input {
    padding: 10px;
    width: 200px;
    border-radius: 6px;
    border: 1px solid #b3895b;
  }
  select {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #b3895b;
    min-width: 220px;
  }
  .note {
    font-size: 0.9rem;
    color: #555;
    margin-top: 8px;
  }
</style>
</head>

<body>

<h1>ðŸ¦ƒ Virtual Friendsgiving Draw</h1>

<!-- PASSWORD SCREEN -->
<div id="pw-screen">
  <h2 style="text-align:center;">Enter Password</h2>
  <div style="text-align:center;">
    <input type="password" id="pw" placeholder="Password"><br><br>
    <button onclick="checkPW()">Enter</button>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="main" class="hidden">

  <div class="box">
    <h2>Welcome to Virtual Friendsgiving!</h2>
    <p>
      This year's celebration will be a <strong>virtual Friendsgiving</strong> where 
      each of us will be randomly assigned someone to buy a meal for. 
    </p>
    <p>
      The meal you choose for your person can be something you think theyâ€™d love 
      <strong>or</strong> something you'd like them to try â€” itâ€™s totally up to you!
    </p>
    <p>
      Please keep the cost of the meal to <strong>no more than $30</strong>.
    </p>
    <p>
      The Friendsgiving gathering will take place on 
      <strong>November 23rd at 2:00 PM EST</strong>.
    </p>
    <p>
      During the event, we will each try to guess <strong>who bought us our meal</strong>.  
    </p>
    <p style="font-style:italic;">
      Generate the assignments once, then each person can privately reveal who they have.
    </p>
  </div>

  <button id="generate-btn" onclick="generateDraw()" style="margin-top:20px;">
    Generate Assignments
  </button>

  <div id="results" class="box hidden">
    <h2>Get Your Assignment</h2>
    <p>
      Select your name, lock it in, and then reveal your person.<br>
      <strong>Only one person should use this page to generate the assignments.</strong>
    </p>

    <label for="who"><strong>I am:</strong></label><br>
    <select id="who">
      <option value="">-- Select your name --</option>
      <option value="Kevin">Kevin</option>
      <option value="Devin">Devin</option>
      <option value="Justin H.">Justin H.</option>
      <option value="Zikiyah">Zikiyah</option>
      <option value="Justin G.">Justin G.</option>
      <option value="Taylor">Taylor</option>
    </select>
    <br>
    <button id="lock-btn" onclick="lockName()">Lock my name</button>

    <p id="locked-message" class="hidden">
      You are locked in as: <strong id="locked-name-text"></strong>
    </p>

    <button id="reveal-btn" onclick="revealPerson()" disabled>
      Reveal my person
    </button>

    <p class="note">
      Tip: Only one person should be at the screen at a time. Once your name is locked, 
      donâ€™t change devices or refresh the page before you reveal.
    </p>
  </div>

</div>

<!-- JAVASCRIPT -->
<script>
// -------------------- PASSWORD PROTECTION --------------------
function checkPW() {
  const correct = "beansgreenspotatoestomatoes";
  if (document.getElementById("pw").value === correct) {
    document.getElementById("pw-screen").classList.add("hidden");
    document.getElementById("main").classList.remove("hidden");
  } else {
    alert("Incorrect password.");
  }
}

// -------------------- GLOBAL DATA --------------------
const names = [
  "Kevin",
  "Devin",
  "Justin H.",
  "Zikiyah",
  "Justin G.",
  "Taylor"
];

const partners = {
  "Kevin":"Devin","Devin":"Kevin",
  "Justin H.":"Zikiyah","Zikiyah":"Justin H.",
  "Justin G.":"Taylor","Taylor":"Justin G."
};

let assignment = null;   // will hold the final mapping
let hasGenerated = false;
let lockedName = null;

// -------------------- GENERATE DRAW --------------------
function shuffle(a){ 
  return a.sort(() => Math.random() - 0.5); 
}

function generateDraw() {
  let receivers, valid = false;
  assignment = {};

  for (let attempt = 0; attempt < 600; attempt++) {
    receivers = shuffle([...names]);
    let ok = true;
    assignment = {};

    for (let i = 0; i < names.length; i++) {
      let g = names[i];
      let r = receivers[i];
      // no self and no partner
      if (g === r || partners[g] === r) {
        ok = false;
        break;
      }
      assignment[g] = r;
    }
    if (ok) {
      valid = true;
      break;
    }
  }

  if (!valid) {
    alert("Could not generate a valid draw. Please try again.");
    assignment = null;
    return;
  }

  hasGenerated = true;

  // Show the results box with dropdown + buttons
  const res = document.getElementById("results");
  res.classList.remove("hidden");

  // Disable generate button so assignments don't change mid-use
  const genBtn = document.getElementById("generate-btn");
  genBtn.disabled = true;
  genBtn.textContent = "Assignments Locked In âœ…";

  // Reset any previous lock
  lockedName = null;
  document.getElementById("who").value = "";
  document.getElementById("locked-message").classList.add("hidden");
  document.getElementById("locked-name-text").textContent = "";
  document.getElementById("reveal-btn").disabled = true;
}

// -------------------- LOCK NAME --------------------
function lockName() {
  if (!hasGenerated || !assignment) {
    alert("Please generate the assignments first.");
    return;
  }

  const select = document.getElementById("who");
  const chosen = select.value;

  if (!chosen) {
    alert("Please select your name first.");
    return;
  }

  lockedName = chosen;

  // Lock the dropdown so it can't be changed
  select.disabled = true;
  document.getElementById("lock-btn").disabled = true;

  // Show locked message
  document.getElementById("locked-name-text").textContent = lockedName;
  document.getElementById("locked-message").classList.remove("hidden");

  // Enable reveal button
  document.getElementById("reveal-btn").disabled = false;
}

// -------------------- REVEAL PERSON --------------------
function revealPerson() {
  if (!hasGenerated || !assignment) {
    alert("Please generate the assignments first.");
    return;
  }

  if (!lockedName) {
    alert("Please lock your name first.");
    return;
  }

  const target = assignment[lockedName];

  if (!target) {
    alert("Something went wrong finding your assignment. Please ask the host to regenerate.");
    return;
  }

  alert(lockedName + ", you will be buying a meal for: " + target);
}
</script>

</body>
</html>
